(function(e){function l(){this.str="";this.characterList=[]}function q(){this.pos=this.domNode=this.character=null;this.visited=this.inserted=this.used=!1}function k(a){var b,c={};if(window.getComputedStyle)if(b=window.getComputedStyle(a,null),b.length)e.each(b,function(){var a=this.replace(/\-([a-z])/,function(b,a){return a.toUpperCase()}),e=b.getPropertyValue(this);c[a]=e});else for(var d in b)"function"!==typeof b[d]&&"length"!==d&&(c[d]=b[d]);else for(d in b=a.currentStyle||a.style,b)b.hasOwnProperty(d)&&
(c[d]=b[d]);return c}function j(a,b,c){this.options=c;this._showCharEffect=null;var d=this;"random"!==this.options.effect&&e.each(e.fn.textualizer.effects,function(){this.name===c.effect&&(d._showCharEffect=this.fn)});var f=a.clone().removeAttr("id").appendTo(document.body);f.css(k(a[0]));f.css({position:"absolute",top:"-1000px"});this.phantomContainer=e("<div />").css({position:"relative",visibility:"hidden"}).appendTo(f);a.css("overflow","hidden");this.elementHeight=a.height();this.container=e("<div />").css("position",
"relative").appendTo(a);this._previous=null;this._position={bottom:a.height()};this.blurbs=[];this.elem=a;b&&b instanceof Array&&this.data(b)}function r(){var a=this,b=[function(b){var d=e.Deferred();b.animate({top:a._position.bottom,opacity:"hide"},d.resolve);return d.promise()},function(b){var a=e.Deferred();b.fadeOut(1E3,a.resolve);return a.promise()}];return b[Math.floor(Math.random()*b.length)]}function m(a){var b=this,c=e.fn.textualizer.effects,d="random"===this.options.effect?c[Math.floor(Math.random()*
(c.length-2))+1].fn:this._showCharEffect,f=e.Deferred(),g=[];e.each(a.characterList,function(a,c){if(!c.inserted){c.domNode.css({left:c.pos.left,top:c.pos.top});var f=e.Deferred();setTimeout(function(){d.call(b,c,f)},Math.random()*s);g.push(f)}});e.when.apply(null,g).done(function(){f.resolve()});return f.promise()}var s=2E3;e.fn.textualizer=function(a,b){var c=arguments,d=function(b){var a=b.data("textualizer");if(!a){var d=[],i;1===c.length&&c[0]instanceof Array?d=c[0]:1===c.length&&"object"===
typeof c[0]?i=c[0]:2===c.length&&(d=c[0],i=c[1]);0===d.length&&b.find("p").each(function(){d.push(e(this).text())});b.html("");a=new j(b,d,e.extend({},e.fn.textualizer.defaults,i));b.data("textualizer",a)}return a}(this);"string"===typeof c[0]&&d[c[0]]&&d[c[0]].apply(d,Array.prototype.slice.call(c,1));return this};e.fn.textualizer.defaults={effect:"random",duration:2E3,rearrangeDuration:1E3,centered:!1};e.fn.textualizer.effects=[{name:"none",fn:function(a){this.container.append(a.domNode.show())}},
{name:"fadeIn",fn:function(a,b){this.container.append(a.domNode.fadeIn(2E3,b.resolve));return b.promise()}},{name:"slideLeft",fn:function(a,b){a.domNode.appendTo(this.container).css({left:-1E3}).show().animate({left:a.pos.left},2E3,b.resolve);return b.promise()}},{name:"slideTop",fn:function(a,b){a.domNode.appendTo(this.container).css({top:-1E3}).show().animate({top:a.pos.top},2E3,b.resolve);return b.promise()}}];l.prototype={use:function(a){var b=null;e.each(this.characterList,function(){if(this.character===
a&&!this.used)return this.used=!0,b=this,!1});return b},reset:function(){e.each(this.characterList,function(){this.used=this.inserted=!1})}};j.prototype={data:function(a){this.stop();this.list=a;this.blurbs=[]},start:function(){function a(c){b._pause||b._rotate(c).done(function(){d.trigger("textualzer.blurbchanged",{index:c});setTimeout(function(){c===b.list.length-1&&(c=-1,e.each(b.blurbs,function(b,a){a.reset()}));c++;b._index=c;a(c)},b.options.duration)})}if(this.list&&0!==this.list.length){var b=
this,c=this._index||0,d=this.elem;this._pause=!1;a(c)}},stop:function(){this.pause();this._previous=null;this._index=0;this.container.empty();this.phantomContainer.empty()},pause:function(){this._pause=!0},_rotate:function(a){var b=e.Deferred(),c=this.blurbs[a];if(!c){var d=[],f,g,h,c=new l;c.str=this.list[a];this.blurbs.push(c);for(a=0,f=c.str.length;a<f;a++)g=c.str.charAt(a),""===g?this.phantomContainer.append(" "):(h=new q,h.character=g,h.domNode=e("<span/>").text(g),this.phantomContainer.append(h.domNode),
d.push(h));var i=this.options.centered?(this.elementHeight-this.phantomContainer.height())/2:0;e.each(d,function(b,a){a.pos=a.domNode.position();a.domNode=a.domNode.clone();a.pos.top+=i;a.domNode.css({left:a.pos.left,top:a.pos.top,position:"absolute"});c.characterList.push(a)});this.phantomContainer.html("")}if(this._previous){var j=this,n=[],o=[],p=[],k=r.call(this);e.each(this._previous.characterList,function(a,b){var d=c.use(b.character);if(d)d.domNode=b.domNode,d.inserted=!0,n.push(d);else{var f=
e.Deferred();o.push(f);k(b.domNode.delay(2E3*Math.random())).done(function(){b.domNode.remove();f.resolve()})}});e.when.apply(null,o).done(function(){setTimeout(function(){e.each(n,function(a,b){var c=e.Deferred();b.domNode.animate({left:b.pos.left,top:b.pos.top},j.options.rearrangeDuration,c.resolve);p.push(c.promise())});e.when.apply(null,p).done(function(){setTimeout(function(){m.call(j,c).done(function(){b.resolve()})},500)})},1E3)})}else m.call(this,c).done(function(){b.resolve()});this._previous=
c;return b.promise()},destroy:function(){this.container.parent().removeData("textualizer").end().remove();this.phantomContainer.remove()}}})(jQuery);