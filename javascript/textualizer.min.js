function(d){d(function(){function l(a,b){window.getComputedStyle?(styles=window.getComputedStyle(a[0],null),d.each(styles,function(c,a){b.css(a,styles.getPropertyValue(a))})):(styles=a[0].currentStyle,d.each(styles,function(a,d){b.css(a,d)}))}function q(){var a=this,b=[function(c){var b=d.Deferred();c.animate({top:a._position.bottom,opacity:"hide"},b.resolve);return b.promise()},function(a){var b=d.Deferred();a.fadeOut(1E3,b.resolve);return b.promise()}];return b[Math.floor(Math.random()*b.length)]} function m(a){var b=this,c="random"===this.options.effect?d.fn.textualizer.effects[g[Math.floor(Math.random()*g.length)]]:d.fn.textualizer.effects[this.options.effect],e=d.Deferred(),h=[];d.each(a.chars,function(a,e){if(!e.inserted){e.domNode.css({left:e.pos.left,top:e.pos.top});var f=d.Deferred();setTimeout(function(){c.call(b,e,f)},Math.random()*r);h.push(f)}});d.when.apply(null,h).done(function(){e.resolve()});return e.promise()}var r=2E3;d.fn.textualizer=function(a,b){var c=arguments,e=function(a){var b= a.data("textualizer");if(!b){var e=[],f;1===c.length&&c[0]instanceof Array?e=c[0]:1===c.length&&"object"===typeof c[0]?f=c[0]:2===c.length&&(e=c[0],f=c[1]);0===e.length&&a.find("p").each(function(){e.push(d(this).text())});a.html("");f=d.extend({},d.fn.textualizer.defaults,f);b=new j(a,e,f);a.data("textualizer",b)}return b}(this);"string"===typeof c[0]&&e[c[0]]&&e[c[0]].apply(e,Array.prototype.slice.call(c,1));return this};d.fn.textualizer.defaults={effect:"random",duration:2E3,rearrangeDuration:1E3}; d.fn.textualizer.effects={none:function(a){this.container.append(a.domNode.show())},fadeIn:function(a,b){this.container.append(a.domNode.fadeIn(2E3,b.resolve));return b.promise()},slideLeft:function(a,b){a.domNode.appendTo(this.container).css({left:-1E3}).show().animate({left:a.pos.left},2E3,b.resolve);return b.promise()},slideTop:function(a,b){a.domNode.appendTo(this.container).css({top:-1E3}).show().animate({top:a.pos.top},2E3,b.resolve);return b.promise()}};var g=[];d.each(d.fn.textualizer.effects, function(a){"none"!==a&&g.push(a)});var n=function(){this.str="";this.chars=[]};n.prototype={use:function(a){for(var b=0,c=this.chars.length;b<c;b++){var d=this.chars[b];if(d.ch===a&&!d.used)return d.used=!0,d}return null},reset:function(){d.each(this.chars,function(a,b){b.inserted=!1;b.used=!1})}};var s=function(){this.pos=this.domNode=this.ch=null;this.visited=this.inserted=this.used=!1},j=function(a,b,c){this.options=c;c=a.clone().removeAttr("id").appendTo(document.body);l(a,c);c.css({position:"absolute", top:"-1000px"});this.phantomContainer=d("<div />").css({position:"relative",visibility:"hidden"}).appendTo(c);a.css("overflow","hidden");this.elementHeight=a.height();this.container=d("<div />").css("position","relative").appendTo(a);this._previous=null;this._position={};this._position.bottom=a.height();this.blurbs=[];b&&b instanceof Array&&this.data(b)};j.prototype={data:function(a){this.stop();this.list=a;this.blurbs=[]},start:function(){function a(c){b._pause||b._rotate(c).done(function(){setTimeout(function(){c=== b.list.length-1&&(c=-1,d.each(b.blurbs,function(a,b){b.reset()}));c++;b._index=c;a(c)},b.options.duration)})}if(this.list&&0!==this.list.length){var b=this,c=this._index||0;this._pause=!1;a(c)}},stop:function(){this.pause();this._previous=null;this._index=0;this.container.empty();this.phantomContainer.empty()},pause:function(){this._pause=!0},_rotate:function(a){var b=d.Deferred(),c=this.blurbs[a];if(!c){var e=[],h,k,i,c=new n;c.str=this.list[a];this.blurbs.push(c);for(a=0,h=c.str.length;a<h;a++)k= c.str.charAt(a),""===k?this.phantomContainer.append(" "):(i=new s,i.ch=k,i.domNode=d("<span/>").text(k),this.phantomContainer.append(i.domNode),e.push(i));var f=this.options.centered?(this.elementHeight-this.phantomContainer.height())/2:0;d.each(e,function(a,b){b.pos=b.domNode.position();b.domNode=b.domNode.clone();b.pos.top+=f;b.domNode.css({left:b.pos.left,top:b.pos.top,position:"absolute"});c.chars.push(b)});this.phantomContainer.html("")}if(this._previous){var g=this,j=[],o=[],p=[],l=q.call(this); d.each(this._previous.chars,function(b,a){var e=c.use(a.ch);if(e)e.domNode=a.domNode,e.inserted=!0,j.push(e);else{var f=d.Deferred();o.push(f);l(a.domNode.delay(2E3*Math.random())).done(function(){a.domNode.remove();f.resolve()})}});d.when.apply(null,o).done(function(){setTimeout(function(){d.each(j,function(b,a){var c=d.Deferred();a.domNode.animate({left:a.pos.left,top:a.pos.top},g.options.rearrangeDuration,c.resolve);p.push(c.promise())});d.when.apply(null,p).done(function(){setTimeout(function(){m.call(g, c).done(function(){b.resolve()})},500)})},1E3)})}else m.call(this,c).done(function(){b.resolve()});this._previous=c;return b.promise()},destroy:function(){this.container.parent().removeData("textualizer").end().remove();this.phantomContainer.remove()}}})})(jQuery);